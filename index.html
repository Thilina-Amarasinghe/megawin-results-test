<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raffle Draw Results</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --sanasili-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
      --shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #05997e 0%, #0600ab 100%); min-height:100vh; padding:10px 5px;}

    /* Modal Base */
    #ticketModal {
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.8); justify-content:center; align-items:center;
      z-index:1000; backdrop-filter: blur(5px);
    }
    .modal-content {
      padding:40px; border-radius:20px; text-align:center;
      max-width:500px; width:90%; position:relative;
      animation: modalSlideIn 0.4s ease-out;
    }
    .modal-icon { font-size: 80px; margin-bottom: 20px; display: block; }
    .modal-title { font-size: 28px; font-weight: 700; margin-bottom: 15px; }
    .modal-ticket-number {
      font-size: 36px; font-weight: 800; padding: 15px 25px;
      border-radius: 12px; margin: 20px 0; display: inline-block;
    }
    .modal-details { margin: 25px 0; padding: 20px; border-radius: 12px; background:#fff; }
    .modal-rank { font-size: 24px; font-weight: 700; margin-bottom: 10px; }
    .modal-prize { font-size: 28px; font-weight: 700; margin: 10px 0; }
    .modal-city { font-size: 20px; margin-top: 10px; }
    #closeModal {
      padding:15px 40px; border:none; border-radius:12px;
      cursor:pointer; font-size:18px; font-weight:600; margin-top:20px;
    }

    @keyframes modalSlideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* 1st Prize Winner (Gold) */
    .winner-modal .modal-content {
      background: #ffd700; color:#000;
    }

    /* 2nd ‚Äì 5th Place (Yellow) */
    .medal-modal .modal-content {
      background: #ffeb3b; color:#000;
    }

    /* Consolation (Green) */
    .consolation-modal .modal-content {
      background: #10b981; color:#fff;
    }

    /* No Win (Red) */
    .no-win-modal .modal-content {
      background: #ef4444; color:#fff;
    }

    /* Pre-draw (Blue) */
    #preDrawPopup > div {
      background: #2563eb; color:#fff;
      padding:40px; border-radius:20px; max-width:500px; width:90%;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header" style="text-align:center;margin-bottom:20px;">
      <h1 style="color:white;font-size:3rem;">Raffle Draw Results</h1>
      <h2 id="drawDate" style="color:yellow;font-size:2rem;">2025.12.26</h2>
      <h2 class="organization" style="color:white;">DLB Welfare Society</h2>
    </div>

    <!-- Content -->
    <div id="mainContent" style="display:none;">
      <h2 style="color:white;text-align:center;">üèÜ Winners</h2>
      <div class="table-container" style="background:white;padding:20px;border-radius:15px;box-shadow:var(--shadow);margin-bottom:30px;">
        <table style="width:100%;border-collapse:collapse;">
          <thead style="background:#667eea;color:white;">
            <tr><th>Rank</th><th>Winning Number</th><th>Prize</th><th>City</th></tr>
          </thead>
          <tbody id="winnersTableBody"></tbody>
        </table>
      </div>

      <h2 style="color:white;text-align:center;">‡∑É‡∑ê‡∂±‡∑É‡∑í‡∂Ω‡∑í ‡∂≠‡∑ä‚Äç‡∂∫‡∑è‡∂ú (Consolation)</h2>
      <div class="table-container" style="background:white;padding:20px;border-radius:15px;box-shadow:var(--shadow);">
        <table style="width:100%;border-collapse:collapse;">
          <thead style="background:#10b981;color:white;">
            <tr><th>#</th><th>Number</th><th>City</th></tr>
          </thead>
          <tbody id="consolationTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pre-draw popup -->
  <div id="preDrawPopup" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;justify-content:center;align-items:center;z-index:2000;">
    <div>
      <h2>Draw Not Started</h2>
      <p>The raffle draw results have not been published yet.</p>
      <button onclick="document.getElementById('preDrawPopup').style.display='none'">OK</button>
    </div>
  </div>

  <!-- Ticket Modal -->
  <div id="ticketModal">
    <div class="modal-content">
      <div class="modal-icon" id="modalIcon"></div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-ticket-number" id="modalTicketNumber"></div>
      <div class="modal-details" id="modalDetails"></div>
      <button id="closeModal">Close</button>
    </div>
  </div>

  <script>
    let winnerData = {};
    let consolationData = {};
    let published = false;

    async function loadData() {
      const response = await fetch("data/draw.json");
      const data = await response.json();

      published = data.published;
      winnerData = data.winners;
      consolationData = data.consolations;

      // Update date
      if (data.drawDate) {
        const d = new Date(data.drawDate);
        document.getElementById("drawDate").textContent = `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')}`;
      }

      if (published) {
        document.getElementById("mainContent").style.display = "block";
        updateTables();
      } else {
        document.getElementById("preDrawPopup").style.display = "flex";
      }
    }

    function updateTables() {
      const winnersTableBody = document.getElementById("winnersTableBody");
      winnersTableBody.innerHTML = Object.entries(winnerData).map(([num,data]) => `
        <tr>
          <td>${data.rank}</td>
          <td>${num}</td>
          <td>${data.prize}</td>
          <td>${data.city}</td>
        </tr>
      `).join("");

      const consolationTableBody = document.getElementById("consolationTableBody");
      consolationTableBody.innerHTML = Object.entries(consolationData).map(([num,data],i) => `
        <tr>
          <td>${i+1}</td>
          <td>${num}</td>
          <td>${data.city}</td>
        </tr>
      `).join("");
    }

    function checkTicket(ticket) {
      const modal = document.getElementById('ticketModal');
      const modalIcon = document.getElementById('modalIcon');
      const modalTitle = document.getElementById('modalTitle');
      const modalTicketNumber = document.getElementById('modalTicketNumber');
      const modalDetails = document.getElementById('modalDetails');

      modal.className = '';
      modalTicketNumber.textContent = ticket;

      if (winnerData[ticket]) {
        const data = winnerData[ticket];
        modalIcon.textContent = data.icon;
        if (data.rank.includes("1st")) {
          modal.classList.add('winner-modal');
          modalTitle.innerHTML = "üéâ Congratulations!";
        } else {
          modal.classList.add('medal-modal');
          modalTitle.innerHTML = "ü•≥ Congratulations!";
        }
        modalDetails.innerHTML = `<div class="modal-rank">${data.rank}</div>
          <div class="modal-prize">${data.prize}</div>
          <div class="modal-city">üìç ${data.city}</div>`;
      } else if (consolationData[ticket]) {
        const data = consolationData[ticket];
        modal.classList.add('consolation-modal');
        modalIcon.textContent = "üéâ";
        modalTitle.innerHTML = "Consolation Prize!";
        modalDetails.innerHTML = `<div class="modal-rank">‡∑É‡∑ê‡∂±‡∑É‡∑í‡∂Ω‡∑í ‡∂≠‡∑ä‚Äç‡∂∫‡∑è‡∂ú‡∂∫</div>
          <div class="modal-prize">10,000 LKR</div>
          <div class="modal-city">üìç ${data.city}</div>`;
      } else {
        modal.classList.add('no-win-modal');
        modalIcon.textContent = "üòî";
        modalTitle.innerHTML = "Sorry!";
        modalDetails.innerHTML = `<div>Your ticket did not win this time.</div>`;
      }
      modal.style.display = "flex";
    }

    document.getElementById('closeModal').onclick = () => {
      document.getElementById('ticketModal').style.display = 'none';
    };

    loadData();
  </script>
</body>
</html>
