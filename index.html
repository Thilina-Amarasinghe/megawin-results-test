<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raffle Draw Results</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- All your original CSS/animations/colors/styles remain unchanged -->
</head>
<body>
  <div class="container">
    <!-- Original content (header, tables, modals etc.) remain unchanged -->
    <div class="table-container">
      <!-- winners + consolation tables populated via JSON -->
    </div>
  </div>

  <!-- Ticket Modal -->
  <div id="ticketModal" style="display:none;">
    <div class="modal-content">
      <div class="modal-icon" id="modalIcon"></div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-ticket-number" id="modalTicketNumber"></div>
      <div class="modal-details" id="modalDetails"></div>
      <button id="closeModal">Close</button>
    </div>
  </div>

  <!-- Pre-draw popup -->
  <div id="preDrawPopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); color:white; display:flex; align-items:center; justify-content:center; z-index:2000;">
    <div style="background:#fff; color:#000; padding:30px; border-radius:12px; max-width:500px; text-align:center;">
      <h2>Upcoming Draw</h2>
      <p id="preDrawMessage"></p>
      <button onclick="document.getElementById('preDrawPopup').style.display='none'">OK</button>
    </div>
  </div>

  <script>
    let drawData = null;

    async function loadDrawData() {
      try {
        const response = await fetch("data/draw.json");
        drawData = await response.json();

        if (drawData.published) {
          document.querySelectorAll(".table-container").forEach(el => el.style.display = "block");
        } else {
          document.querySelectorAll(".table-container").forEach(el => el.style.display = "none");
          const msg = "Draw Date: " + drawData.drawDate + "<br>" +
                      "Results Published immediately after the draw and on www.welfare.dlb.lk<br>" +
                      "Also published in Dinamina, Thinakural, and Daily News newspapers";
          document.getElementById("preDrawMessage").innerHTML = msg;
          document.getElementById("preDrawPopup").style.display = "flex";
        }

        const params = new URLSearchParams(window.location.search);
        const scannedTicket = params.get("ticket");
        if (scannedTicket && drawData.published) {
          checkTicket(scannedTicket);
        }
      } catch (err) {
        console.error("Error loading draw.json:", err);
      }
    }

    function checkTicket(ticket) {
      const modal = document.getElementById("ticketModal");
      const modalIcon = document.getElementById("modalIcon");
      const modalTitle = document.getElementById("modalTitle");
      const modalTicketNumber = document.getElementById("modalTicketNumber");
      const modalDetails = document.getElementById("modalDetails");

      modal.className = "";
      modal.classList.add("modal");
      modalTicketNumber.textContent = ticket;

      if (drawData.winners[ticket]) {
        modal.classList.add("winner-modal");
        const data = drawData.winners[ticket];
        modalIcon.textContent = "üëë";
        modalTitle.innerHTML = `üéâ ‡∑É‡∑î‡∂∑ ‡∂¥‡∑ê‡∂≠‡∑î‡∂∏‡∑ä!<br>Congratulations!`;
        modalDetails.innerHTML = `
          <div class="modal-rank">${data.rank}</div>
          <div class="modal-prize">${data.prize}</div>
          <div class="modal-city">üìç ${data.city}</div>
        `;
      } else if (drawData.consolations[ticket]) {
        modal.classList.add("consolation-modal");
        const data = drawData.consolations[ticket];
        modalIcon.textContent = "üéâ";
        modalTitle.innerHTML = `‡∑É‡∑î‡∂∑ ‡∂¥‡∑ê‡∂≠‡∑î‡∂∏‡∑ä!<br>Consolation Prize!`;
        modalDetails.innerHTML = `
          <div class="modal-rank">‡∑É‡∑ê‡∂±‡∑É‡∑í‡∂Ω‡∑í ‡∂≠‡∑ä‚Äç‡∂∫‡∑è‡∂ú‡∂∫</div>
          <div class="modal-prize">10,000 LKR</div>
          <div class="modal-city">üìç ${data.city}</div>
        `;
      } else {
        modal.classList.add("no-win-modal");
        modalIcon.textContent = "üòî";
        modalTitle.innerHTML = `‡∂ö‡∂´‡∂ú‡∑è‡∂ß‡∑î‡∂∫‡∑í!<br>Sorry!`;
        modalDetails.innerHTML = `
          <div style="font-size: 30px; color: #6b7280; margin: 20px 0;">
            ‡∂î‡∂∂‡∂ú‡∑ö ‡∂ß‡∑í‡∂ö‡∂ß‡∑ä ‡∂∏‡∑ô‡∑Ä‡∂ª ‡∂≠‡∑ä‚Äç‡∂∫‡∑è‡∂ú‡∂∫‡∂ö‡∑ä ‡∑Ñ‡∑í‡∂∏‡∑í‡∑Ä ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠.<br>
            Your ticket did not win this time.
          </div>
        `;
      }
      modal.style.display = "flex";
    }

    document.getElementById("closeModal").onclick = () => {
      document.getElementById("ticketModal").style.display = "none";
    };

    document.getElementById("ticketModal").onclick = (e) => {
      if (e.target === document.getElementById("ticketModal")) {
        document.getElementById("ticketModal").style.display = "none";
      }
    };

    loadDrawData();
  </script>
</body>
</html>
