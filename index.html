<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raffle Draw Results</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* keep all original styles (shortened for brevity) */
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #05997e 0%, #0600ab 100%); }
    .table-container { background:white; border-radius:25px; overflow:hidden; margin-bottom:50px; }
    #ticketModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000; }
    #preDrawModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:2000; }
    #preDrawModal .modal-content { background:white; padding:30px; border-radius:10px; max-width:500px; text-align:center; }
    #closePreDraw { margin-top:20px; padding:10px 20px; background:#667eea; color:white; border:none; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header"><h1>Raffle Draw Results</h1></div>
    <!-- Winners table -->
    <div class="table-container winners-table-container">
      <table class="winners-table">
        <thead><tr><th>Rank</th><th>Winning Number</th><th>Prize</th><th>City</th></tr></thead>
        <tbody id="winnersBody"></tbody>
      </table>
    </div>
    <!-- Consolations table -->
    <div class="table-container cons-table-container">
      <table class="sanasili-table">
        <thead><tr><th>#</th><th>Consolation prizes</th><th>City</th></tr></thead>
        <tbody id="consolationsBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Ticket Modal -->
  <div id="ticketModal">
    <div class="modal-content">
      <div class="modal-icon" id="modalIcon"></div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-ticket-number" id="modalTicketNumber"></div>
      <div class="modal-details" id="modalDetails"></div>
      <button id="closeModal">Close</button>
    </div>
  </div>

  <!-- Pre-draw Popup -->
  <div id="preDrawModal">
    <div class="modal-content">
      <h2>üéüÔ∏è Results Pending</h2>
      <p>Results will be published immediately after the draw<br>
      and on www.welfare.dlb.lk<br>
      Also published in Dinamina, Thinakural, and Daily News newspapers.</p>
      <button id="closePreDraw">OK</button>
    </div>
  </div>

  <script>
    let drawData = null;

    async function loadData() {
      const response = await fetch("data/draw.json");
      drawData = await response.json();

      const preDrawModal = document.getElementById("preDrawModal");

      if (!drawData.published) {
        preDrawModal.style.display = "flex";
        document.querySelectorAll(".table-container").forEach(el => el.style.display = "none");
      } else {
        preDrawModal.style.display = "none";
        populateTables(drawData);
      }

      document.getElementById("closePreDraw").onclick = () => {
        preDrawModal.style.display = "none";
      };

      const params = new URLSearchParams(window.location.search);
      const scannedTicket = params.get("ticket");
      if (scannedTicket && drawData.published) {
        checkTicket(scannedTicket);
      }
    }

    function populateTables(data) {
      const winnersBody = document.getElementById("winnersBody");
      winnersBody.innerHTML = "";
      Object.keys(data.winners).forEach(ticket => {
        const w = data.winners[ticket];
        winnersBody.innerHTML += `<tr><td>${w.rank}</td><td>${ticket}</td><td>${w.prize}</td><td>${w.city}</td></tr>`;
      });

      const consBody = document.getElementById("consolationsBody");
      consBody.innerHTML = "";
      let i = 1;
      Object.keys(data.consolations).forEach(ticket => {
        const c = data.consolations[ticket];
        consBody.innerHTML += `<tr><td>${i++}</td><td>${ticket}</td><td>${c.city}</td></tr>`;
      });
    }

    function checkTicket(ticket) {
      if (!drawData || !drawData.published) {
        document.getElementById("preDrawModal").style.display = "flex";
        return;
      }
      const modal = document.getElementById("ticketModal");
      const modalIcon = document.getElementById("modalIcon");
      const modalTitle = document.getElementById("modalTitle");
      const modalTicketNumber = document.getElementById("modalTicketNumber");
      const modalDetails = document.getElementById("modalDetails");

      modal.className = "";
      modalTicketNumber.textContent = ticket;

      if (drawData.winners[ticket]) {
        const d = drawData.winners[ticket];
        modal.classList.add("winner-modal");
        modalIcon.textContent = d.icon || "üéâ";
        modalTitle.innerHTML = "‡∑É‡∑î‡∂∑ ‡∂¥‡∑ê‡∂≠‡∑î‡∂∏‡∑ä!<br>Congratulations!";
        modalDetails.innerHTML = `<div>${d.rank}</div><div>${d.prize}</div><div>üìç ${d.city}</div>`;
      } else if (drawData.consolations[ticket]) {
        const d = drawData.consolations[ticket];
        modal.classList.add("consolation-modal");
        modalIcon.textContent = "üéâ";
        modalTitle.innerHTML = "‡∑É‡∑î‡∂∑ ‡∂¥‡∑ê‡∂≠‡∑î‡∂∏‡∑ä!<br>Consolation Prize!";
        modalDetails.innerHTML = `<div>‡∑É‡∑ê‡∂±‡∑É‡∑í‡∂Ω‡∑í ‡∂≠‡∑ä‚Äç‡∂∫‡∑è‡∂ú‡∂∫</div><div>10,000 LKR</div><div>üìç ${d.city}</div>`;
      } else {
        modal.classList.add("no-win-modal");
        modalIcon.textContent = "üòî";
        modalTitle.innerHTML = "‡∂ö‡∂´‡∂ú‡∑è‡∂ß‡∑î‡∂∫‡∑í!<br>Sorry!";
        modalDetails.innerHTML = `<div>‡∂î‡∂∂‡∂ú‡∑ö ‡∂ß‡∑í‡∂ö‡∂ß‡∑ä ‡∂¥‡∂≠‡∑ä‚Äç‡∂ª‡∂∫ ‡∂∏‡∑ô‡∑Ä‡∂ª ‡∂≠‡∑ä‚Äç‡∂∫‡∑è‡∂ú‡∂∫‡∂ö‡∑ä ‡∑Ñ‡∑í‡∂∏‡∑í‡∑Ä ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠.<br>Your ticket did not win this time.</div>`;
      }
      modal.style.display = "flex";
    }

    document.getElementById("closeModal").onclick = () => {
      document.getElementById("ticketModal").style.display = "none";
    };

    loadData();
  </script>
</body>
</html>
